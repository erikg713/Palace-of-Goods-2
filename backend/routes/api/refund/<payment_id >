@payment_bp.route('/refund/<payment_id>', methods=['POST'])
@jwt_required()
def refund_payment(payment_id):
    current_user_id = get_jwt_identity()
    payment = Payment.query.filter_by(identifier=payment_id, user_id=current_user_id).first()

    if not payment or payment.status != "completed":
        return jsonify({"msg": "Refund not allowed"}), 400

    try:
        # Refund logic (future Pi SDK integration)
        payment.status = "refunded"
        db.session.commit()
        return jsonify({"msg": "Payment refunded successfully"}), 200
    except Exception as e:
        return jsonify({"msg": "Failed to refund payment", "error": str(e)}), 500