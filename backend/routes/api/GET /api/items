from flask import Blueprint, jsonify, request
from flask_jwt_extended import jwt_required, get_jwt_identity
from models import Item

item_bp = Blueprint('item_bp', __name__)

@item_bp.route('/', methods=['GET'])
@jwt_required()
def get_items():
    try:
        current_user_id = get_jwt_identity()
        page = request.args.get('page', 1, type=int)  # Default to page 1
        per_page = request.args.get('per_page', 10, type=int)  # Default 10 items per page

        items = Item.query.filter_by(user_id=current_user_id).paginate(page, per_page, error_out=False)
        return jsonify({
            "items": [{"id": item.id, "name": item.name, "category": item.category, "price": item.price} for item in items.items],
            "total": items.total,
            "pages": items.pages,
            "current_page": items.page
        })
    except Exception as e:
        return jsonify({"error": str(e)}), 500
