def handle_payment_webhook():
    data = request.get_json()
    identifier = data.get('identifier')
    status = data.get('status')

    # Find the payment in the database
    payment = Payment.query.filter_by(pi_payment_id=identifier).first()
    if not payment:
        return jsonify({'message': 'Payment not found'}), 404

    # Update the payment status
    payment.status = status
    if status == 'COMPLETED':
        payment.completed_at = db.func.current_timestamp()

    db.session.commit()

    return jsonify({'message': 'Payment status updated successfully'}), 200
payment_data = verify_payment('unique_payment_id')
if payment_data:
    if payment_data['status'] == 'COMPLETED':
        print('Payment is completed!')
    else:
        print('Payment is not completed:', payment_data['status'])
else:
    print('Failed to verify payment.')
